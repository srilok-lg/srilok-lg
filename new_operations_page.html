<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Network</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        custom: {
                            yellow: '#FFCC00',
                            red: '#FF3B30',
                            green: '#34C759',
                        }
                    }
                },
            },
        }
    </script>
    <style>
        .mermaid .node rect { stroke: #ffffff; }
        .mermaid .node text { fill: #000000; }
        .mermaid .edgePath path { stroke: #ffffff; }
        .mermaid .clickable:hover rect { cursor: pointer; }
    </style>
</head>
<body class="bg-black text-white font-sans">
    <div class="fixed top-0 left-0 right-0 bg-black shadow-md z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <h1 id="graphTitle" class="text-2xl font-bold">Operations Flow</h1>
            <div class="flex items-center">
                <label class="relative inline-flex items-center cursor-pointer">
                    <input type="checkbox" id="graphToggle" class="sr-only peer">
                    <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                </label>
                <span id="toggleLabel" class="ml-3 text-sm font-medium">Switch to Infrastructure Map</span>
            </div>
        </div>
    </div>
    <div id="graphDiv" class="container mx-auto mt-20 p-4 bg-black rounded-lg shadow-lg overflow-auto" style="height: calc(100vh - 5rem);"></div>
    <script type="module">
        const infraTree = `
        graph TD
            Salesforce("Salesforce") --> A2("Campaign Parameters")
            C4("Segment Portal") --> Segments
            Segments("Segments") --> A2
            LG("LG") --> B5("Native segments")
            B5 --> C4
            LG --> A1("Inventory")
            Data_p("Data Partnerhips") --> A1
            A1 --> |Internal & External| B2("SSP")
            A2 --> B1("DSP")
            B1 --> C1("Peregrine")
            B1 --> C2("Beeswax")
            B2 --> SSP_logs
            C1 --> PP
            C2 --> PP
            A1 <--> Programmatic("Programmatic")
            PP("Pixel Pinger") --> DAS("DAS")
            DAS --> Kasper("Kasper")
            DAS --> Insights("Insights")
            DAS --> Steller("Steller")
            SSP_logs --> DAS
            SSP_logs("SSP Logs") --> Elastic("Elastic")

            click Salesforce "salesforce.html" "Go to Salesforce page"
            click Opportunities "opportunities.html" "Go to Opportunities page"
            click A2 "campaign_parameters.html" "Go to Campaign Parameters page"
            click C4 "segment_portal.html" "Go to Segment Portal page"
            click Segments "segments.html" "Go to Segments page"
            click DAGs "dags.html" "Go to DAGs page"
            click B5 "native_segments.html" "Go to Native Segments page"
            click A1 "inventory.html" "Go to Inventory page"
            click Data_p "data_partnerships.html" "Go to Data Partnerships page"
            click B2 "ssp.html" "Go to SSP page"
            click B1 "dsp.html" "Go to DSP page"
            click C1 "peregrine.html" "Go to Peregrine page"
            click C2 "beeswax.html" "Go to Beeswax page"
            click SSP_logs "ssp_logs.html" "Go to SSP Logs page"
            click PP "pixel_pinger.html" "Go to Pixel Pinger page"
            click Programmatic "programmatic.html" "Go to Programmatic page"
            click DAS "das.html" "Go to DAS page"
            click Kasper "kasper.html" "Go to Kasper page"
            click Insights "insights.html" "Go to Insights page"
            click Steller "steller.html" "Go to Steller page"
            click Elastic "elastic.html" "Go to Elastic page"

            classDef yellow fill:#FFCC00,stroke:#ffffff,color:#000000;
            classDef red fill:#FF3B30,stroke:#ffffff,color:#000000;
            classDef green fill:#34C759,stroke:#ffffff,color:#000000;
            classDef white fill:#ffffff,stroke:#ffffff,color:#000000;
            classDef black fill:#000000,stroke:#ffffff,color:#ffffff;
            
            class Salesforce,A2,B1,C1,C2 yellow;
            class C4,Segments,B5,PP red;
            class LG,A1,Data_p,B2,Programmatic green;
            class SSP_logs,DAS,Kasper,Insights,Steller,Elastic white;

            classDef clickable cursor:pointer;
            class Salesforce,Opportunities,A2,C4,Segments,DAGs,B5,A1,Data_p,B2,B1,C1,C2,C3,SSP_logs,PP,Programmatic,DAS,Kasper,Insights,Reporting,Steller,Elastic clickable;        
        `;

        let currentGraph = 'operations';

        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'dark',
            fontFamily: 'Inter, sans-serif',
            flowchart: {
                curve: 'basis',
                nodeSpacing: 50,
                rankSpacing: 50,
            }
        });

        function renderGraph() {
            const graphDiv = document.getElementById('graphDiv');
            if (currentGraph === 'operations') {
                fetch('new_operations_flow.html')
                    .then(response => response.text())
                    .then(data => {
                        graphDiv.innerHTML = data;
                        graphDiv.firstChild.classList.add('w-full', 'h-full');
                    })
                    .catch(error => console.error('Error loading new_operations_flow.html:', error));
            } else {
                mermaid.render('mermaid-graph', infraTree).then(result => {
                    graphDiv.innerHTML = result.svg;
                    graphDiv.firstChild.classList.add('w-full', 'h-full');
                    addHoverEffect();
                });
            }
        }

        function addHoverEffect() {
            const nodes = document.querySelectorAll('.node');
            nodes.forEach(node => {
                node.classList.add('transition', 'duration-300', 'ease-in-out', 'hover:scale-105');
                node.style.transformOrigin = 'center center';
            });
        }

        document.addEventListener('DOMContentLoaded', renderGraph);

        document.getElementById('graphToggle').addEventListener('change', function() {
            const graphTitle = document.getElementById('graphTitle');
            const toggleLabel = document.getElementById('toggleLabel');

            if (this.checked) {
                currentGraph = 'infra';
                graphTitle.textContent = 'Infrastructure Map';
                toggleLabel.textContent = 'Switch to Operations Flow';
            } else {
                currentGraph = 'operations';
                graphTitle.textContent = 'Operations Flow';
                toggleLabel.textContent = 'Switch to Infrastructure Map';
            }

            renderGraph();
        });
    </script>
</body>
</html>
