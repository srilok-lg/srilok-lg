<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advertiser to User Flow</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            line-height: 1.6;
            padding: 20px;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #2c3e50; }
        #flowchart {
            width: 100%;
            height: 80vh;
            position: relative;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 20px;
            padding: 20px;
        }
        .bento-box {
            border-radius: 10px;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #000000;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
        }
        .bento-box:hover {
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }
        .subgraph {
            border: 2px dashed #666;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }
        .subgraph-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .back-link {
            font-family: Inter, sans-serif;
            font-size: 16px;
            color: #3498db;
            text-decoration: none;
            position: relative;
            transition: transform 0.3s ease;
            display: inline-block;
        }
        .back-link:before {
            content: "\2190";
            margin-right: 5px;
        }
        .back-link:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <a href="#" class="back-link" onclick="goBackToInframap(); return false;">Back to Infrastructure Map</a>
    <h1>Advertiser to User Flow</h1>
    <svg id="flowchart" viewBox="0 0 1000 600">
        <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
                <polygon points="0 0, 10 3.5, 0 7" fill="#000000"/>
            </marker>
        </defs>
        
        const bentoBoxes = [
            { id: 'advertisers', label: 'ADVERTISERS', color: '#ffffff', gridArea: '1 / 1 / 5 / 2' },
            { id: 'salesforce', label: 'SALESFORCE', color: '#f2f2f7', gridArea: '1 / 2 / 2 / 3' },
            { id: 'programmatic', label: 'PROGRAMMATIC', color: '#e8f3ec', gridArea: '2 / 2 / 3 / 3' },
            { id: 'mosaic', label: 'MOSAIC', color: '#fef5ea', gridArea: '3 / 2 / 4 / 3' },
            { id: 'beeswax', label: 'BEESWAX', color: '#e5f8ff', gridArea: '1 / 3 / 2 / 4' },
            { id: 'peregrine', label: 'PEREGRINE', color: '#e5f8ff', gridArea: '2 / 3 / 3 / 4' },
            { id: 'tools', label: 'TOOLS', color: '#f2f2f7', gridArea: '3 / 3 / 4 / 4' },
            { id: 'data', label: 'DATA', color: '#f2f2f7', gridArea: '4 / 3 / 5 / 4' },
            { id: 'ssp', label: 'SSP/AD EXCHANGE', color: '#e8f3ec', gridArea: '1 / 4 / 5 / 5' },
            { id: 'publisher', label: 'PUBLISHER', color: '#fef5ea', gridArea: '1 / 5 / 5 / 6' },
            { id: 'user', label: 'USER', color: '#ffffff', gridArea: '1 / 6 / 5 / 7' },
        ];

        const flowchart = document.getElementById('flowchart');

        // Create subgraphs
        const campaignManagement = document.createElement('div');
        campaignManagement.className = 'subgraph';
        campaignManagement.style.gridArea = '1 / 2 / 5 / 4';
        campaignManagement.innerHTML = '<div class="subgraph-title">Campaign Management</div>';
        flowchart.appendChild(campaignManagement);

        <rect x="200" y="50" width="400" height="500" fill="none" stroke="#666" stroke-dasharray="5,5"/>
        <text x="400" y="70" text-anchor="middle" font-size="14" font-weight="600">Campaign Management</text>

        const dsp = document.createElement('div');
        dsp.className = 'subgraph';
        dsp.style.gridArea = '1 / 3 / 3 / 4';
        dsp.innerHTML = '<div class="subgraph-title">DSP</div>';
        campaignManagement.appendChild(dsp);

        <rect x="400" y="100" width="180" height="200" fill="none" stroke="#666" stroke-dasharray="5,5"/>
        <text x="490" y="120" text-anchor="middle" font-size="14" font-weight="600">DSP</text>

        bentoBoxes.forEach(box => {
            const div = document.createElement('div');
            div.id = box.id;
            div.className = 'bento-box';
            div.style.backgroundColor = box.color;
            div.style.gridArea = box.gridArea;
            div.textContent = box.label;
            
            if (['salesforce', 'programmatic', 'mosaic', 'tools', 'data'].includes(box.id)) {
                campaignManagement.appendChild(div);
            } else if (['beeswax', 'peregrine'].includes(box.id)) {
                dsp.appendChild(div);
            } else {
                flowchart.appendChild(div);
            }
        });

        <g id="advertisers">
            <rect x="50" y="50" width="100" height="500" rx="10" ry="10" fill="#ffffff" stroke="#000000"/>
            <text x="100" y="300" text-anchor="middle">ADVERTISERS</text>
        </g>
        <g id="salesforce">
            <rect x="220" y="100" width="150" height="100" rx="10" ry="10" fill="#f2f2f7" stroke="#000000"/>
            <text x="295" y="150" text-anchor="middle">SALESFORCE</text>
        </g>
        <g id="programmatic">
            <rect x="220" y="220" width="150" height="100" rx="10" ry="10" fill="#e8f3ec" stroke="#000000"/>
            <text x="295" y="270" text-anchor="middle">PROGRAMMATIC</text>
        </g>
        <g id="mosaic">
            <rect x="220" y="340" width="150" height="100" rx="10" ry="10" fill="#fef5ea" stroke="#000000"/>
            <text x="295" y="390" text-anchor="middle">MOSAIC</text>
        </g>
        <g id="beeswax">
            <rect x="420" y="140" width="140" height="80" rx="10" ry="10" fill="#e5f8ff" stroke="#000000"/>
            <text x="490" y="180" text-anchor="middle">BEESWAX</text>
        </g>
        <g id="peregrine">
            <rect x="420" y="240" width="140" height="80" rx="10" ry="10" fill="#e5f8ff" stroke="#000000"/>
            <text x="490" y="280" text-anchor="middle">PEREGRINE</text>
        </g>
        <g id="tools">
            <rect x="420" y="340" width="140" height="80" rx="10" ry="10" fill="#f2f2f7" stroke="#000000"/>
            <text x="490" y="380" text-anchor="middle">TOOLS</text>
        </g>
        <g id="data">
            <rect x="420" y="440" width="140" height="80" rx="10" ry="10" fill="#f2f2f7" stroke="#000000"/>
            <text x="490" y="480" text-anchor="middle">DATA</text>
        </g>
        <g id="ssp">
            <rect x="650" y="50" width="100" height="500" rx="10" ry="10" fill="#e8f3ec" stroke="#000000"/>
            <text x="700" y="300" text-anchor="middle">SSP/AD EXCHANGE</text>
        </g>
        <g id="publisher">
            <rect x="780" y="50" width="100" height="500" rx="10" ry="10" fill="#fef5ea" stroke="#000000"/>
            <text x="830" y="300" text-anchor="middle">PUBLISHER</text>
        </g>
        <g id="user">
            <rect x="910" y="50" width="100" height="500" rx="10" ry="10" fill="#ffffff" stroke="#000000"/>
            <text x="960" y="300" text-anchor="middle">USER</text>
        </g>

        const arrows = [
            { from: 'advertisers', to: 'salesforce', label: 'IO' },
            { from: 'programmatic', to: 'salesforce' },
            { from: 'salesforce', to: 'mosaic' },
            { from: 'mosaic', to: 'beeswax' },
            { from: 'beeswax', to: 'mosaic' },
            { from: 'mosaic', to: 'peregrine' },
            { from: 'peregrine', to: 'mosaic' },
            { from: 'mosaic', to: 'ssp' },
            { from: 'ssp', to: 'publisher' },
            { from: 'publisher', to: 'user' },
        ];

        <path d="M150,300 H220" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <text x="185" y="290" text-anchor="middle" font-size="12">IO</text>
        
        <path d="M295,320 V340" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M370,390 H420" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M490,220 V240" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M560,280 H590 V390 H370" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M370,390 H650" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M750,300 H780" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
        <path d="M880,300 H910" stroke="#000000" stroke-width="2" marker-end="url(#arrowhead)"/>
    </svg>
    
    <script>
        function goBackToInframap() {
            if (window.parent !== window.self) {
                window.parent.postMessage({ action: 'navigateToInframap' }, '*');
            } else {
                window.location.href = 'index.html#infra';
            }
        }
    </script>
</body>
</html>
