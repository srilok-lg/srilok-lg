<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph Network</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            padding: 20px;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #2c3e50; }
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
            margin-bottom: 20px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #2196F3;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        .switch-label {
            display: inline-block;
            vertical-align: middle;
            margin-left: 10px;
        }
        #graphDiv {
            margin-top: 20px;
            margin-bottom: 20px;
        }
        .clickable:hover {
            cursor: pointer;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.3));
            transform: scale(1.05);
        }
                #flowchart {
            width: 100%;
            height: 80vh;
            position: relative;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 20px;
            padding: 20px;
        }
        .bento-box {
            border-radius: 10px;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #000000;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
        }
        .bento-box:hover {
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }
        .subgraph {
            border: 2px dashed #666;
            border-radius: 15px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            justify-content: space-around;
            align-items: center;
        }
        .subgraph-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .back-link {
            font-family: Inter, sans-serif;
            font-size: 16px;
            color: #3498db;
            text-decoration: none;
            position: relative;
            transition: transform 0.3s ease;
            display: inline-block;
        }
        .back-link:before {
            content: "\2190";
            margin-right: 5px;
        }
        .back-link:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <h1 id="graphTitle">Operations Flow</h1>
    <label class="switch">
        <input type="checkbox" id="graphToggle">
        <span class="slider"></span>
    </label>
    <span class="switch-label" id="toggleLabel">Switch to Infrastructure Map</span>
    <div id="graphDiv"></div>
    <script>
        const bentoBoxes = [
            { id: 'advertisers', label: 'ADVERTISERS', color: '#ffffff', gridArea: '1 / 1 / 5 / 2' },
            { id: 'salesforce', label: 'SALESFORCE', color: '#f2f2f7', gridArea: '1 / 2 / 2 / 3' },
            { id: 'programmatic', label: 'PROGRAMMATIC', color: '#e8f3ec', gridArea: '2 / 2 / 3 / 3' },
            { id: 'mosaic', label: 'MOSAIC', color: '#fef5ea', gridArea: '3 / 2 / 4 / 3' },
            { id: 'beeswax', label: 'BEESWAX', color: '#e5f8ff', gridArea: '1 / 3 / 2 / 4' },
            { id: 'peregrine', label: 'PEREGRINE', color: '#e5f8ff', gridArea: '2 / 3 / 3 / 4' },
            { id: 'tools', label: 'TOOLS', color: '#f2f2f7', gridArea: '3 / 3 / 4 / 4' },
            { id: 'data', label: 'DATA', color: '#f2f2f7', gridArea: '4 / 3 / 5 / 4' },
            { id: 'ssp', label: 'SSP/AD EXCHANGE', color: '#e8f3ec', gridArea: '1 / 4 / 5 / 5' },
            { id: 'publisher', label: 'PUBLISHER', color: '#fef5ea', gridArea: '1 / 5 / 5 / 6' },
            { id: 'user', label: 'USER', color: '#ffffff', gridArea: '1 / 6 / 5 / 7' },
        ];

        const flowchart = document.getElementById('flowchart');

        // Create subgraphs
        const campaignManagement = document.createElement('div');
        campaignManagement.className = 'subgraph';
        campaignManagement.style.gridArea = '1 / 2 / 5 / 4';
        campaignManagement.innerHTML = '<div class="subgraph-title">Campaign Management</div>';
        flowchart.appendChild(campaignManagement);

        const dsp = document.createElement('div');
        dsp.className = 'subgraph';
        dsp.style.gridArea = '1 / 3 / 3 / 4';
        dsp.innerHTML = '<div class="subgraph-title">DSP</div>';
        campaignManagement.appendChild(dsp);

        bentoBoxes.forEach(box => {
            const div = document.createElement('div');
            div.id = box.id;
            div.className = 'bento-box';
            div.style.backgroundColor = box.color;
            div.style.gridArea = box.gridArea;
            div.textContent = box.label;
            
            if (['salesforce', 'programmatic', 'mosaic', 'tools', 'data'].includes(box.id)) {
                campaignManagement.appendChild(div);
            } else if (['beeswax', 'peregrine'].includes(box.id)) {
                dsp.appendChild(div);
            } else {
                flowchart.appendChild(div);
            }
        });

        const arrows = [
            { from: 'advertisers', to: 'salesforce', label: 'IO' },
            { from: 'programmatic', to: 'salesforce' },
            { from: 'salesforce', to: 'mosaic' },
            { from: 'mosaic', to: 'beeswax' },
            { from: 'beeswax', to: 'mosaic' },
            { from: 'mosaic', to: 'peregrine' },
            { from: 'peregrine', to: 'mosaic' },
            { from: 'mosaic', to: 'ssp' },
            { from: 'ssp', to: 'publisher' },
            { from: 'publisher', to: 'user' },
        ];

        function createArrow(from, to, label) {
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.pointerEvents = 'none';
            
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute('stroke', '#000000');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('marker-end', 'url(#arrowhead)');
            
            const arrowhead = document.createElementNS("http://www.w3.org/2000/svg", "marker");
            arrowhead.setAttribute('id', 'arrowhead');
            arrowhead.setAttribute('markerWidth', '10');
            arrowhead.setAttribute('markerHeight', '7');
            arrowhead.setAttribute('refX', '9');
            arrowhead.setAttribute('refY', '3.5');
            arrowhead.setAttribute('orient', 'auto');

            const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
            polygon.setAttribute('fill', '#000000');

            arrowhead.appendChild(polygon);
            svg.appendChild(arrowhead);
            svg.appendChild(path);

            if (label) {
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute('fill', '#000000');
                text.setAttribute('font-size', '12');
                text.textContent = label;
                svg.appendChild(text);
            }

            flowchart.appendChild(svg);

            return { path, text };
        }

        arrows.forEach(arrow => {
            const { path, text } = createArrow(arrow.from, arrow.to, arrow.label);

            const updateArrow = () => {
                const fromElement = document.getElementById(arrow.from);
                const toElement = document.getElementById(arrow.to);
                if (fromElement && toElement) {
                    const fromRect = fromElement.getBoundingClientRect();
                    const toRect = toElement.getBoundingClientRect();
                    const flowchartRect = flowchart.getBoundingClientRect();

                    const fromX = fromRect.left + fromRect.width / 2 - flowchartRect.left;
                    const fromY = fromRect.top + fromRect.height / 2 - flowchartRect.top;
                    const toX = toRect.left + toRect.width / 2 - flowchartRect.left;
                    const toY = toRect.top + toRect.height / 2 - flowchartRect.top;

                    path.setAttribute('d', `M${fromX},${fromY} L${toX},${toY}`);

                    if (text) {
                        const midX = (fromX + toX) / 2;
                        const midY = (fromY + toY) / 2;
                        text.setAttribute('x', midX);
                        text.setAttribute('y', midY);
                    }
                }
            };

            updateArrow();
            window.addEventListener('resize', updateArrow);
        });

            click Media_Planning "media_planning.html" "Go to Media Planning page"
            click Campaign_Management "campaign_management.html" "Go to Campaign Management page"
            click Inventory "inventory.html" "Go to Inventory page"
            click Billing "billing.html" "Go to Billing page"
            click Deliverables "deliverables.html" "Go to Deliverables page"

            classDef clickable cursor:pointer;
            class Media_Planning,Campaign_Management,Inventory,Billing,Deliverables clickable;
        `;

        const infraTree = `
        graph TD
            Salesforce("Salesforce") --> A2("Campaign Parameters")
            C4("Segment Portal") --> Segments
            Segments("Segments") --> A2
            LG("LG") --> B5("Native segments")
            B5 --> C4
            LG --> A1("Inventory")
            Data_p("Data Partnerhips") --> A1
            A1 --> |Internal & External| B2("SSP")
            A2 --> B1("DSP")
            B1 --> C1("Peregrine")
            B1 --> C2("Beeswax")
            B2 --> SSP_logs
            C1 --> PP
            C2 --> PP
            A1 <--> Programmatic("Programmatic")
            PP("Pixel Pinger") --> DAS("DAS")
            DAS --> Kasper("Kasper")
            DAS --> Insights("Insights")
            DAS --> Steller("Steller")
            SSP_logs --> DAS
            SSP_logs("SSP Logs") --> Elastic("Elastic")

            click Salesforce "salesforce.html" "Go to Salesforce page"
            click Opportunities "opportunities.html" "Go to Opportunities page"
            click A2 "campaign_parameters.html" "Go to Campaign Parameters page"
            click C4 "segment_portal.html" "Go to Segment Portal page"
            click Segments "segments.html" "Go to Segments page"
            click DAGs "dags.html" "Go to DAGs page"
            click B5 "native_segments.html" "Go to Native Segments page"
            click A1 "inventory.html" "Go to Inventory page"
            click Data_p "data_partnerships.html" "Go to Data Partnerships page"
            click B2 "ssp.html" "Go to SSP page"
            click B1 "dsp.html" "Go to DSP page"
            click C1 "peregrine.html" "Go to Peregrine page"
            click C2 "beeswax.html" "Go to Beeswax page"
            click SSP_logs "ssp_logs.html" "Go to SSP Logs page"
            click PP "pixel_pinger.html" "Go to Pixel Pinger page"
            click Programmatic "programmatic.html" "Go to Programmatic page"
            click DAS "das.html" "Go to DAS page"
            click Kasper "kasper.html" "Go to Kasper page"
            click Insights "insights.html" "Go to Insights page"
            click Steller "steller.html" "Go to Steller page"
            click Elastic "elastic.html" "Go to Elastic page"
    
            classDef clickable cursor:pointer;
            class Salesforce,Opportunities,A2,C4,Segments,DAGs,LG,B5,A1,Data_p,B2,B1,C1,C2,C3,SSP_logs,PP,Programmatic,DAS,Kasper,Insights,Reporting,Steller,Elastic clickable;        
        `;

        let currentGraph = 'operations';
        
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'neutral',
            fontFamily: 'Inter, -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif',
            flowchart: {
                curve: 'basis',
                nodeSpacing: 50,
                rankSpacing: 50,
            }
        });

        function renderGraph() {
            const graphDiv = document.getElementById('graphDiv');
            const graphDefinition = currentGraph === 'operations' ? operationsFlow : infraTree;
            mermaid.render('mermaid-graph', graphDefinition).then(result => {
                graphDiv.innerHTML = result.svg;
            });
        }

        document.addEventListener('DOMContentLoaded', renderGraph);

        document.getElementById('graphToggle').addEventListener('change', function() {
            const graphTitle = document.getElementById('graphTitle');
            const toggleLabel = document.getElementById('toggleLabel');
            
            if (this.checked) {
                currentGraph = 'infra';
                graphTitle.textContent = 'Infrastructure Map';
                toggleLabel.textContent = 'Switch to Operations Flow';
            } else {
                currentGraph = 'operations';
                graphTitle.textContent = 'Operations Flow';
                toggleLabel.textContent = 'Switch to Infrastructure Map';
            }
            
            renderGraph();
        });
            
            window.addEventListener('message', function(event) {
                if (event.data.action === 'navigateToInframap') {
                    document.getElementById('graphToggle').checked = true;
                    document.getElementById('graphToggle').dispatchEvent(new Event('change'));
                }
            });
            
            window.addEventListener('load', function() {
                if (window.location.hash === '#infra') {
                    document.getElementById('graphToggle').checked = true;
                    document.getElementById('graphToggle').dispatchEvent(new Event('change'));
                }
            });
    </script>
</body>
</html>
