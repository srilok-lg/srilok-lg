<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inventory</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            padding: 20px;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #2c3e50; }
        #flowchart {
            width: 100%;
            height: 80vh;
            position: relative;
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-template-rows: repeat(4, 1fr);
            gap: 40px; /* Increased gap to make arrows appear longer */
            padding: 40px; /* Increased padding to create more space around the edges */
        }
        .bento-box {
            border-radius: 10px; /* Slightly reduced border-radius */
            padding: 10px; /* Reduced padding to make boxes smaller */
            display: flex;
            justify-content: center;
            align-items: center;
            border: 1px solid #000000;
            transition: all 0.3s ease;
            font-size: 14px; /* Reduced font size to fit smaller boxes */
        }
        .bento-box:hover {
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }
        .back-link {
            font-family: Inter, sans-serif;
            font-size: 16px;
            color: #3498db;
            text-decoration: none;
            position: relative;
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .back-link:before {
            content: "\2190"; /* Left arrow Unicode character */
            margin-right: 5px;
        }

        .back-link:after {
            content: '';
            position: absolute;
            width: 100%;
            height: 2px;
            bottom: 0;
            left: 0;
            background-color: #3498db;
            transform: scaleX(0);
            transform-origin: bottom right;
            transition: transform 0.3s ease;
        }

        .back-link:hover {
            transform: scale(1.05);

        }

        .back-link:hover:after {
            transform: scaleX(1);
            transform-origin: bottom left;
        }
    </style>
</head>
<body>
    <a href="#" class="back-link" onclick="goBackToInframap(); return false;">Back to Infrastructure Map</a>
    <script>        
        function goBackToInframap() {
            if (window.parent !== window.self) {
                // We're in an iframe
                window.parent.postMessage({ action: 'navigateToInframap' }, '*');
            } else {
                // We're not in an iframe, navigate directly
                window.location.href = 'index.html#infra';
            }
        }
    </script>
</body>
<body>
    <h1>Inventory</h1>
    <div id="flowchart"></div>
    <script>
        const bentoBoxes = [
            { id: 'inventory', label: 'Inventory', color: '#ffffff', gridArea: '1 / 3 / 2 / 4' },
            { id: 'lg', label: 'LG', color: '#f2f2f7', gridArea: '2 / 2 / 3 / 3' },
            { id: 'external', label: 'External', color: '#fef5ea', gridArea: '2 / 4 / 3 / 5' },
            { id: 'native', label: 'Native', color: '#f2f2f7', gridArea: '3 / 1 / 4 / 2' },
            { id: 'ctv', label: 'CTV', color: '#e8f3ec', gridArea: '3 / 3 / 4 / 4' },
            { id: 'crossScreen', label: 'Cross Screen', color: '#fef5ea', gridArea: '3 / 5 / 4 / 6' },
            { id: 'adSlots', label: 'Ad Slots', color: '#f2f2f7', gridArea: '4 / 1 / 5 / 2' },
            { id: 'oo', label: 'O&O', color: '#e8f3ec', gridArea: '4 / 2 / 5 / 3' },
            { id: 'adsPlus', label: 'Ads Plus', color: '#e8f3ec', gridArea: '4 / 3 / 5 / 4' },
            { id: 'openMarket', label: 'Open Market', color: '#ffffff', gridArea: '4 / 4 / 5 / 5' },
        ];

        const flowchart = document.getElementById('flowchart');

        bentoBoxes.forEach(box => {
            const div = document.createElement('div');
            div.id = box.id;
            div.className = 'bento-box';
            div.style.backgroundColor = box.color;
            div.style.gridArea = box.gridArea;
            div.textContent = box.label;
            flowchart.appendChild(div);
        });

        const arrows = [
            { from: 'inventory', to: 'lg' },
            { from: 'inventory', to: 'external' },
            { from: 'lg', to: 'native' },
            { from: 'lg', to: 'ctv' },
            { from: 'external', to: 'ctv' },
            { from: 'external', to: 'crossScreen' },
            { from: 'native', to: 'adSlots' },
            { from: 'ctv', to: 'oo' },
            { from: 'ctv', to: 'adsPlus' },
            { from: 'ctv', to: 'openMarket' },
            { from: 'crossScreen', to: 'openMarket' },
        ];

        function getIntersectionPoint(fromRect, toRect) {
            const fromCenterX = fromRect.left + fromRect.width / 2;
            const fromCenterY = fromRect.top + fromRect.height / 2;
            const toCenterX = toRect.left + toRect.width / 2;
            const toCenterY = toRect.top + toRect.height / 2;

            const angle = Math.atan2(toCenterY - fromCenterY, toCenterX - fromCenterX);

            let fromX, fromY, toX, toY;

            // From box intersection
            if (Math.abs(Math.cos(angle)) > Math.abs(Math.sin(angle))) {
                fromX = fromCenterX + Math.sign(Math.cos(angle)) * fromRect.width / 2;
                fromY = fromCenterY + Math.tan(angle) * (fromX - fromCenterX);
            } else {
                fromY = fromCenterY + Math.sign(Math.sin(angle)) * fromRect.height / 2;
                fromX = fromCenterX + (fromY - fromCenterY) / Math.tan(angle);
            }

            // To box intersection
            if (Math.abs(Math.cos(angle)) > Math.abs(Math.sin(angle))) {
                toX = toCenterX - Math.sign(Math.cos(angle)) * toRect.width / 2;
                toY = toCenterY + Math.tan(angle) * (toX - toCenterX);
            } else {
                toY = toCenterY - Math.sign(Math.sin(angle)) * toRect.height / 2;
                toX = toCenterX + (toY - toCenterY) / Math.tan(angle);
            }

            return { fromX, fromY, toX, toY };
        }

        arrows.forEach(arrow => {
            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.style.position = 'absolute';
            svg.style.top = '0';
            svg.style.left = '0';
            svg.style.width = '100%';
            svg.style.height = '100%';
            svg.style.pointerEvents = 'none';
            
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute('stroke', '#000000');
            path.setAttribute('stroke-width', '2');
            path.setAttribute('fill', 'none');
            path.setAttribute('marker-end', 'url(#arrowhead)');
            
            const arrowhead = document.createElementNS("http://www.w3.org/2000/svg", "marker");
            arrowhead.setAttribute('id', 'arrowhead');
            arrowhead.setAttribute('markerWidth', '10');
            arrowhead.setAttribute('markerHeight', '7');
            arrowhead.setAttribute('refX', '9');
            arrowhead.setAttribute('refY', '3.5');
            arrowhead.setAttribute('orient', 'auto');

            const polygon = document.createElementNS("http://www.w3.org/2000/svg", "polygon");
            polygon.setAttribute('points', '0 0, 10 3.5, 0 7');
            polygon.setAttribute('fill', '#000000');

            arrowhead.appendChild(polygon);
            svg.appendChild(arrowhead);
            svg.appendChild(path);
            flowchart.appendChild(svg);

            const updateArrow = () => {
                const fromElement = document.getElementById(arrow.from);
                const toElement = document.getElementById(arrow.to);
                if (fromElement && toElement) {
                    const fromRect = fromElement.getBoundingClientRect();
                    const toRect = toElement.getBoundingClientRect();
                    const flowchartRect = flowchart.getBoundingClientRect();

                    const { fromX, fromY, toX, toY } = getIntersectionPoint(fromRect, toRect);

                    const adjustedFromX = fromX - flowchartRect.left;
                    const adjustedFromY = fromY - flowchartRect.top;
                    const adjustedToX = toX - flowchartRect.left;
                    const adjustedToY = toY - flowchartRect.top;

                    path.setAttribute('d', `M${adjustedFromX},${adjustedFromY} L${adjustedToX},${adjustedToY}`);
                }
            };
            updateArrow();
            window.addEventListener('resize', updateArrow);
        });
    </script>
</body>
</html>
